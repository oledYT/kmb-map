<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>Route Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
      padding: 0;
    }
  </style>
  <script src="https://map.qq.com/api/gljs?v=1.exp&key=FNMBZ-RKIWB-MQ3UL-NKSLR-H5SFF-JQBNG"></script>
</head>
<body>
  <div id="map"></div>

  <script>
     const map = new TMap.Map("map", {
      center: new TMap.LatLng(22.302711, 114.177216),
      zoom: 13
    });

    const styles = {
      routeStyle: {
        color: "#3777FF",
        width: 6
      },
      marker: new TMap.MarkerStyle({
        width: 25,
        height: 35,
        anchor: { x: 16, y: 32 },
        src: 'https://mapapi.qq.com/web/lbs/javascriptGL/demo/img/markerDefault.png'
      })
    };

    const polylineLayer = new TMap.MultiPolyline({
      id: "routeLayer",
      map: map,
      styles: styles,
      geometries: []
    });

    const markerLayer = new TMap.MultiMarker({
      map: map,
      styles: { marker: styles.marker },
      geometries: []
    });

    // ✅ 支持二维数组或对象数组绘制
    function drawRoute(data) {
      try {
        console.log("绘制数据：", data);

        let latlngs = [];
        let markers = [];

        data.forEach((point, index) => {
          let lat, lng, name;

          if (Array.isArray(point)) {
            // 处理二维数组：[["22.3","114.2"],["22.4","114.3"]]
            lat = parseFloat(point[0]);
            lng = parseFloat(point[1]);
            name = `站点 ${index + 1}`;
          } else {
            // 处理对象数组：{lat: ..., lng: ..., name: ...}
            lat = parseFloat(point.lat);
            lng = parseFloat(point.lng);
            name = point.name || `站点 ${index + 1}`;
          }

          const latlng = new TMap.LatLng(lat, lng);
          latlngs.push(latlng);

          markers.push({
            id: 'marker-' + index,
            position: latlng,
            styleId: 'marker',
            content: name,
            title: name
          });
        });

        // 画线
        polylineLayer.setGeometries([{
          styleId: "routeStyle",
          paths: latlngs
        }]);

        // 添加标记
        markerLayer.setGeometries(markers);

        // 居中
        if (latlngs.length > 0) {
          map.setCenter(latlngs[0]);
        }
      } catch (err) {
        console.error("drawRoute 错误：", err);
      }
    }
  </script>
</body>
</html>

