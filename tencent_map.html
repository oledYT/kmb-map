<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>公交线路地图</title>
  <style>
    html, body, #map {
      margin: 0;
      height: 100%;
      width: 100%;
    }
  </style>
  <script src="https://map.qq.com/api/gljs?v=1.exp&key=FNMBZ-RKIWB-MQ3UL-NKSLR-H5SFF-JQBNG"></script>
</head>
<body>
  <div id="map"></div>

  <script>
    let map = new TMap.Map("map", {
      center: new TMap.LatLng(22.32066, 114.17076),
      zoom: 13,
    });

    let polylineLayer;
    let markerLayer;

    function drawRoute(latlngs) {
      console.log("drawRoute 被调用，路径点：", latlngs);

      const points = latlngs.map(p => new TMap.LatLng(p[0], p[1]));

      // 折线
      if (polylineLayer) polylineLayer.setGeometries([]);
      polylineLayer = new TMap.MultiPolyline({
        map,
        styles: {
          'route': new TMap.PolylineStyle({
            color: '#3777FF',
            width: 6,
            borderColor: '#FFF',
            borderWidth: 2,
          }),
        },
        geometries: [{
          id: 'route',
          styleId: 'route',
          paths: points
        }]
      });

      // 所有站点标记
      if (markerLayer) markerLayer.setGeometries([]);
      const geometries = points.map((pt, index) => ({
        id: 'marker_' + index,
        position: pt,
        styleId: 'marker'
      }));

      markerLayer = new TMap.MultiMarker({
        map,
        styles: {
          marker: new TMap.MarkerStyle({
            width: 20,
            height: 30,
            anchor: { x: 10, y: 30 }
          }),
        },
        geometries: geometries
      });

      if (points.length > 0) {
        map.setCenter(points[0]);
      }
    }
  </script>
</body>
</html>


